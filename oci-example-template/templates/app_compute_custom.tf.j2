# ═══════════════════════════════════════════════════════════════
# Custom Variable Proxy Layer: ${upper(app_name)} Compute Instances
# 
# This file is OPTIONAL. If this file exists, it will override the
# default var2hcl logic from ${app_name}_compute.tf
# ═══════════════════════════════════════════════════════════════

locals {
  # Custom proxy layer: Transform ${upper(app_name)} compute instance variables into locals
  # This will override the default var2hcl logic from ${app_name}_compute.tf
  # 
  # Add your custom transformation logic here:
  # - Transform values (e.g., normalize, uppercase, add defaults)
  # - Add computed fields
  # - Apply business logic rules
  # - Merge with additional data sources
  ${app_name}_compute_instances_var2hcl_custom = {
    for k, v in var.${app_name}_compute_instances : k => {
      instance_fqrn = k
      zone          = v.zone # Zone FQRN (e.g., zone://vm_demo/demo/app)
      availability_domain = module.infra_zones[v.zone].ad
      nsg          = v.nsg
      spec         = merge(v.spec, {
        # Example: Add custom transformations
        # enable_bastion_plugin = true  # Force enable bastion plugin for all instances
        # shape = "VM.Standard.E4.Flex"  # Override shape for all instances
      })
    }
  }
}

