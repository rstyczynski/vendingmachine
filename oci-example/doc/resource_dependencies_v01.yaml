# ═══════════════════════════════════════════════════════════════
# OCI Vending Machine - Resource requires
# 
# This YAML file defines the dependency structure for all resources.
# It specifies what resources are required (mandatory) and optional
# when creating a new resource.
# ═══════════════════════════════════════════════════════════════

resources:
  # ═══════════════════════════════════════════════════════════════
  # Foundation Resources (no requires)
  # ═══════════════════════════════════════════════════════════════

  SDK_config:
    description: "OCI connection configuration"
    fqrn_scheme: oci://{tenancy}@{realm}/
    type: 
    requires:
      mandatory: []
      optional: []
    provides:
      - realm
      - tenancy
      - region

  realm:
    description: "OCI Realm - top-level organizational boundary (e.g., oc1, oc2, oc3)"
    fqrn_scheme: "realm://{realm_name}"
    requires:
      mandatory:
        - SDK_config
      optional: []

  tenancy:
    description: "OCI Tenancy - root level resource"
    fqrn_scheme: "tenancy://{realm}/{name}"
    requires:
      mandatory:
        - realm
      optional: []
    provides: []

  region:
    description: "OCI Region - defines where resources are created"
    fqrn_scheme: "region://{realm}/{region_name}"
    requires:
      mandatory:
        - tenancy
      optional: []
      provides:
        - tenancy
        - realm

  # ═══════════════════════════════════════════════════════════════
  # Identity Resources
  # ═══════════════════════════════════════════════════════════════

  compartment:
    description: "OCI Compartment - logical grouping of resources (inter-region resource)"
    fqrn_scheme: "cmp:///{compartment_path}"
    requires:
      mandatory:
        - tenancy
      optional: []
    provides: []

  # ═══════════════════════════════════════════════════════════════
  # Logging Resources
  # ═══════════════════════════════════════════════════════════════

  log_group:
    description: "OCI Log Group - container for log objects"
    fqrn_scheme: "log_group://{compartment_path}/{name}"
    requires:
      mandatory:
        - compartment
      optional: []

  # ═══════════════════════════════════════════════════════════════
  # Network Resources
  # ═══════════════════════════════════════════════════════════════

  vcn:
    description: "Virtual Cloud Network - isolated network environment"
    fqrn_scheme: "vcn://{compartment_path}/{vcn_name}"
    requires:
      mandatory:
        - compartment
        - region
      optional:
        - internet_gateway
        - nat_gateway
        - service_gateway
    provides: []

  internet_gateway:
    description: "Internet Gateway - provides public internet access for VCN"
    fqrn_scheme: "igw://{compartment_path}/{vcn_name}/{igw_name}"
    requires:
      mandatory:
        - compartment
        - vcn
      optional: []

  nat_gateway:
    description: "NAT Gateway - provides internet access for private subnets"
    fqrn_scheme: "nat://{compartment_path}/{vcn_name}/{nat_name}"
    requires:
      mandatory:
        - compartment
        - vcn
      optional: []

  service_gateway:
    description: "Service Gateway - provides access to OCI services"
    fqrn_scheme: "sgw://{compartment_path}/{vcn_name}/{sgw_name}"
    requires:
      mandatory:
        - compartment
        - vcn
      optional: []

  subnet:
    description: "Subnet - IP address range within a VCN"
    fqrn_scheme: "sub://{compartment_path}/{vcn_name}/{subnet_name}"
    requires:
      mandatory:
        - compartment
        - vcn
      optional:
        - log_group: "For VCN flow logs (enable_flow_log = true)"
    provides: []


  nsg:
    description: "Network Security Group - firewall rules for network traffic"
    fqrn_scheme: "nsg://{compartment_path}/{vcn_name}/{nsg_name}"
    requires:
      mandatory:
        - compartment
        - vcn
      optional: []
    provides: []

  # ═══════════════════════════════════════════════════════════════
  # Zone Resources (Logical Grouping)
  # ═══════════════════════════════════════════════════════════════

  zone:
    description: "Zone - logical grouping of subnet and availability domain"
    fqrn_scheme: "zone://{compartment_path}/{zone_name}?region={region}"
    requires:
      mandatory:
        - subnet
      optional: []
    provides:
      - subnet
      - availability_domain

  # ═══════════════════════════════════════════════════════════════
  # Compute Resources
  # ═══════════════════════════════════════════════════════════════

  compute_instance:
    description: "Compute Instance - virtual machine"
    fqrn_scheme: "instance://{compartment_path}/{instance_name}"
    requires:
      mandatory:
        - zone: "Required for subnet and availability domain"
        - either:
          - internet_gateway
          - nat_gateway
          - bastion
      optional:
        - nsg: "Network Security Groups for firewall rules (can specify multiple)"
    provides: []


  # ═══════════════════════════════════════════════════════════════
  # Security Resources
  # ═══════════════════════════════════════════════════════════════

  bastion:
    description: "OCI Bastion Service - secure access to private resources"
    fqrn_scheme: "bastion://{compartment_path}/{bastion_name}"
    requires:
      mandatory:
        - subnet: "Target subnet for bastion sessions"
        - service_gateway
        - either:
          - internet_gateway
          - nat_gateway
      optional: []
    provides: []

  app2:
    description: "APP1 - application layer"
    fqrn_scheme: "app1://{compartment_path}/{app2_name}"
    requires:
      mandatory:
        - compute_instance
        - nsg
        - bastion